@if (cart?.items?.length != 0) {

@if (!paymentSuccess) {
<form
  [formGroup]="orderForm"
  class="max-w-3xl mx-auto p-6 bg-white rounded-lg mt-16  shadow space-y-6"
>
  <h2 class="text-2xl font-semibold">Place Order</h2>

  <!-- Shipping Method -->
  <div>
    <label class="block mb-1 font-medium">Shipping Method</label>
    <select
      formControlName="shippingMethodId"
      class="w-full border rounded p-2"
    >
      <option value="" disabled selected>Select a shipping method</option>
      @for (m of shippingMethods; track $index) {
            <option [value]="m._id">{{ m.name }}</option>
            }
    </select>

    @if (shippingMethodId?.touched && shippingMethodId?.invalid) {
      <p class="text-sm text-red-600 mt-1">Shipping method is required.</p>
    }
  </div>

  <!-- Payment Method -->
  <div>
    <label class="block mb-1 font-medium">Payment Method</label>
    <div class="flex gap-4">
      <label class="inline-flex items-center">
        <input
          type="radio"
          formControlName="paymentMethod"
          value="COD"
          class="mr-2"
        />
        Cash on Delivery
      </label>
      <label class="inline-flex items-center">
        <input
          type="radio"
          formControlName="paymentMethod"
          value="Stripe"
          class="mr-2"
        />
        Stripe
      </label>
     
    </div>

    @if (paymentMethod?.touched && paymentMethod?.invalid) {
      <p class="text-sm text-red-600 mt-1">Please choose a payment method.</p>
    }
  </div>

 


</form>
<form
  [formGroup]="shippingForm"
  class="max-w-3xl mx-auto mt-8 p-6 bg-white rounded-lg mb-16 shadow space-y-6"
>
  <h2 class="text-2xl font-semibold">Shipping Details</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Full Name -->
    <div>
      <label class="block mb-1 font-medium">Full Name</label>
      <input
        formControlName="fullName"
        type="text"
        class="w-full border rounded p-2"
        placeholder="Your name"
      />
      @if (shippingForm.get('fullName')?.touched && shippingForm.get('fullName')?.invalid) {
        <p class="text-sm text-red-600 mt-1">Full name is required.</p>
      }
    </div>

    <!-- Phone -->
    <div>
      <label class="block mb-1 font-medium">Phone</label>
      <input
        formControlName="phone"
        type="tel"
        class="w-full border rounded p-2"
        placeholder="+20 1xx xxx xxxx"
      />
      @if (shippingForm.get('phone')?.touched && shippingForm.get('phone')?.invalid) {
        <p class="text-sm text-red-600 mt-1">Phone is required.</p>
      }
    </div>

    <!-- Address Line 1 -->
    <div class="md:col-span-2">
      <label class="block mb-1 font-medium">Address Line 1</label>
      <input
        formControlName="addressLine1"
        type="text"
        class="w-full border rounded p-2"
        placeholder="Street, building, floor"
      />
      @if (shippingForm.get('addressLine1')?.touched && shippingForm.get('addressLine1')?.invalid) {
        <p class="text-sm text-red-600 mt-1">Address line 1 is required.</p>
      }
    </div>

    <!-- Address Line 2 -->
    <div class="md:col-span-2">
      <label class="block mb-1 font-medium">Address Line 2</label>
      <input
        formControlName="addressLine2"
        type="text"
        class="w-full border rounded p-2"
        placeholder="Apartment, landmark (optional)"
      />
    
    </div>

    <!-- City -->
    <div>
      <label class="block mb-1 font-medium">City</label>
      <input
        formControlName="city"
        type="text"
        class="w-full border rounded p-2"
        placeholder="Cairo"
      />
      @if (shippingForm.get('city')?.touched && shippingForm.get('city')?.invalid) {
        <p class="text-sm text-red-600 mt-1">City is required.</p>
      }
    </div>

    <!-- State / Governorate -->
    <div>
      <label class="block mb-1 font-medium">State / Governorate</label>
      <input
        formControlName="state"
        type="text"
        class="w-full border rounded p-2"
        placeholder="Giza (optional)"
      />
      
    </div>

    <!-- Postal Code -->
    <div>
      <label class="block mb-1 font-medium">Postal Code</label>
      <input
        formControlName="postalCode"
        type="text"
        class="w-full border rounded p-2"
        placeholder="12345"
      />
      @if (shippingForm.get('postalCode')?.touched && shippingForm.get('postalCode')?.invalid) {
        <p class="text-sm text-red-600 mt-1">Postal code is required.</p>
      }
    </div>

    <!-- Country -->
    <div>
      <label class="block mb-1 font-medium">Country</label>
      <input
        formControlName="country"
        type="text"
        class="w-full border rounded p-2"
        placeholder="Egypt"
      />
      @if (shippingForm.get('country')?.touched && shippingForm.get('country')?.invalid) {
        <p class="text-sm text-red-600 mt-1">Country is required.</p>
      }
    </div>
  </div>


  
    <button
      (click)="checkout()"
      [disabled]="shippingForm.invalid"
      class="px-4 py-2 bg-primary text-white rounded disabled:opacity-60 cursor-pointer hover:bg-primary-70 "
    >
      Checkout
    </button>

</form>
}@else {
  <div class="min-h-screen bg-gradient-to-b from-green-50 to-gray-50 flex items-center justify-center p-6">
  <div class="w-full max-w-lg">
    <div role="alert" aria-live="polite" class="flex justify-center">
      <div class="w-full bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 sm:p-8 text-center">
        <div class="inline-block p-6 rounded-2xl bg-green-50 border border-green-100 animate-[pop_500ms_ease-out_both]">

          <!-- Icon -->
          <div class="mx-auto w-28 h-28 flex items-center justify-center rounded-full bg-green-100/60 ring-4 ring-green-50 animate-[pop_520ms_cubic-bezier(.2,.9,.3,1)_both]">
            <svg viewBox="0 0 120 120" class="w-20 h-20" aria-hidden="true">
              <!-- Circle -->
              <circle cx="60" cy="60" r="46" fill="none" stroke="#bbf7d0" stroke-width="8"
                class="stroke-dasharray-[1000] stroke-dashoffset-[1000] animate-[draw_700ms_ease_forwards_120ms]"></circle>
              <!-- Check -->
              <path d="M40 65 L55 80 L80 45" stroke="#16a34a" stroke-width="8" stroke-linecap="round"
                stroke-linejoin="round"
                class="opacity-0 origin-center animate-[pop_350ms_ease_600ms_both]"></path>
              <!-- Pulse -->
              <circle cx="60" cy="60" r="48" fill="none" stroke="rgba(16,185,129,0.1)" stroke-width="16"
                class="opacity-80 animate-pulse" />
            </svg>
          </div>

          <h1 class="mt-6 text-2xl font-semibold text-green-700">Payment Successful!</h1>

          <p class="mt-3 text-sm text-green-600/90 max-w-xs mx-auto">
            Your payment has been processed successfully. Thank you for your purchase!
          </p>

          <div class="mt-5 text-xs text-green-600/80 flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 10l4.553 2.276A1 1 0 0120 13.17V18a2 2 0 01-2 2H6a2 2 0 01-2-2v-4.829a2 2 0 01.447-1.276L9 10m6 0V6a3 3 0 10-6 0v4"/>
            </svg>
            <span>Transaction ID: <strong class="text-green-700">#A1B2C3</strong></span>
          </div>

          <div class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-3">
            <!-- Replace with routerLink or (click) in Angular -->
            <a routerLink="/menu"
              class="px-5 py-2 rounded-full bg-green-600 hover:bg-green-700 text-white font-medium shadow-sm transition-transform active:scale-95">
              Continue
            </a>

            <a [routerLink]="['/order/',currentOrderId]"
              class="px-5 py-2 rounded-full bg-white border border-gray-200 text-gray-700 font-medium shadow-sm hover:shadow-md">
              View Receipt
            </a>
          </div>

          <p class="mt-4 text-xs text-gray-500">
            A confirmation email has been sent to your address.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

}}@else {
  <div class="min-h-screen flex justify-center items-center">
  <div class="flex flex-col items-center justify-center my-auto">
    <i class="fa-solid fa-cart-shopping text-gray-400 text-9xl"></i>
    <span class="text-gray-400 text-3xl my-5">Your Cart is empty</span>
  </div></div>
}